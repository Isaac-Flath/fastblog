<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Terraform Basics Part 1 | Isaac’s Blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Terraform Basics Part 1" />
<meta name="author" content="Isaac Flath" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Creating EC2 instances in a managed way using terraform" />
<meta property="og:description" content="Creating EC2 instances in a managed way using terraform" />
<link rel="canonical" href="https://isaac-flath.github.io/fastblog/aws/infrastructure/terraform/devops/2020/07/15/Terraform-Part-1.html" />
<meta property="og:url" content="https://isaac-flath.github.io/fastblog/aws/infrastructure/terraform/devops/2020/07/15/Terraform-Part-1.html" />
<meta property="og:site_name" content="Isaac’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-15T00:00:00-05:00" />
<script type="application/ld+json">
{"url":"https://isaac-flath.github.io/fastblog/aws/infrastructure/terraform/devops/2020/07/15/Terraform-Part-1.html","@type":"BlogPosting","headline":"Terraform Basics Part 1","dateModified":"2020-07-15T00:00:00-05:00","datePublished":"2020-07-15T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://isaac-flath.github.io/fastblog/aws/infrastructure/terraform/devops/2020/07/15/Terraform-Part-1.html"},"author":{"@type":"Person","name":"Isaac Flath"},"description":"Creating EC2 instances in a managed way using terraform","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/fastblog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://isaac-flath.github.io/fastblog/feed.xml" title="Isaac's Blog" /><link rel="shortcut icon" type="image/x-icon" href="/fastblog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/fastblog/">Isaac&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/fastblog/about/">About Me</a><a class="page-link" href="/fastblog/search/">Search</a><a class="page-link" href="/fastblog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Terraform Basics Part 1</h1><p class="page-description">Creating EC2 instances in a managed way using terraform</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-07-15T00:00:00-05:00" itemprop="datePublished">
        Jul 15, 2020
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Isaac Flath</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/fastblog/categories/#AWS">AWS</a>
        &nbsp;
      
        <a class="category-tags-link" href="/fastblog/categories/#Infrastructure">Infrastructure</a>
        &nbsp;
      
        <a class="category-tags-link" href="/fastblog/categories/#Terraform">Terraform</a>
        &nbsp;
      
        <a class="category-tags-link" href="/fastblog/categories/#Devops">Devops</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/Isaac-Flath/fastblog/tree/master/_notebooks/2020-07-15-Terraform Part 1.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/fastblog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/Isaac-Flath/fastblog/master?filepath=_notebooks%2F2020-07-15-Terraform+Part+1.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/fastblog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/Isaac-Flath/fastblog/blob/master/_notebooks/2020-07-15-Terraform Part 1.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/fastblog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Intro">Intro </a></li>
<li class="toc-entry toc-h1"><a href="#Setup">Setup </a></li>
<li class="toc-entry toc-h1"><a href="#What-is-Terraform">What is Terraform </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Variables">Variables </a></li>
<li class="toc-entry toc-h3"><a href="#Actions">Actions </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Full-EC2-setup">Full EC2 setup </a>
<ul>
<li class="toc-entry toc-h3"><a href="#vars.tf">vars.tf </a></li>
<li class="toc-entry toc-h3"><a href="#terraform.tfvars">terraform.tfvars </a></li>
<li class="toc-entry toc-h3"><a href="#provider.tf">provider.tf </a></li>
<li class="toc-entry toc-h3"><a href="#instance.tf">instance.tf </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Apply-the-Changes">Apply the Changes </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-07-15-Terraform Part 1.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Intro">
<a class="anchor" href="#Intro" aria-hidden="true"><span class="octicon octicon-link"></span></a>Intro<a class="anchor-link" href="#Intro"> </a>
</h1>
<p>In this blog we are going to take a look at Terraform.  Terraform is tool that enables you to manage your cloud infrastructure in an auditable and programmatic way.  In this initial post we are going to go through the most basic application, creating and spinning up an EC2 instance.  Future posts will build on this for other applications</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Setup">
<a class="anchor" href="#Setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup<a class="anchor-link" href="#Setup"> </a>
</h1>
<p>You will need to install Terraform in your terminal.  I am not going to cover installation in this post, but you can check out terraform.io and install if from there.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="What-is-Terraform">
<a class="anchor" href="#What-is-Terraform" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is Terraform<a class="anchor-link" href="#What-is-Terraform"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Many people think Terraform is just a bunch of config files, but rather than thinking of it as config files it is more helpful to think of it as a programming language.  You can define lists, maps (similar to python dictionaries), strings, and perform actions using values in those variables.</p>
<h3 id="Variables">
<a class="anchor" href="#Variables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Variables<a class="anchor-link" href="#Variables"> </a>
</h3>
<p>For example, Here's how I could define a map, where I may store different ami's for different region.</p>

<pre><code>variable "AMIS" {
    type = map(string)
    default = {
        us-east-1 = "ami-0ac80df6eff0e70b5",
        us-east-2 = "ami-31432143214213435"
    }
}</code></pre>
<p>Then in terrarorm console get that value using:</p>
<p><code>var.AMIS.us-east-1</code></p>
<p>So this is how we can get and store different configuration options.  But Terraform is not just variables.  You also have ways of running your code to deploy things.  For example <code>terraform plan</code> shows you what it would do if you deployed.  <code>terraform apply</code> deploys your options and <code>terraform destroy</code> destroys all your infrastructure defined.</p>
<p>But what is it applying?  So far all we have done is define a variable.  Let's define an EC2 instance.</p>
<h3 id="Actions">
<a class="anchor" href="#Actions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Actions<a class="anchor-link" href="#Actions"> </a>
</h3>
<pre><code>resource "aws_instance" "web" {
ami = "${lookup(var.AMIS, var.AWS_REGION)}"
instance_type = "t2.micro"
}</code></pre>
<p>From the above we can see we have most of what we need to launch an EC2 instance.  We define an AMI by looking up the AWS_Region variable from the AMIS variable we defined above.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Full-EC2-setup">
<a class="anchor" href="#Full-EC2-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Full EC2 setup<a class="anchor-link" href="#Full-EC2-setup"> </a>
</h1>
<p>You may have noticed, there's a few things missing from the above. For example, how does it connect to AWS?  How do you give it the credentials without putting them in github?  We will create 4 files that gets a good organized setup for the full thing.</p>
<ul>
<li>instance.tf:  This will be the actual command that defined the EC2 instance we want to create</li>
<li>vars.tf:  We can define all the variables we will need here</li>
<li>provider.tf:  This will have the command needed to connect to our AWS account</li>
<li>terraform.tfvars:  This will store our aws credentials</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="vars.tf">
<a class="anchor" href="#vars.tf" aria-hidden="true"><span class="octicon octicon-link"></span></a>vars.tf<a class="anchor-link" href="#vars.tf"> </a>
</h3>
<p>First we will define all the variables we need.  You may notice I do not put any values in the the credentials.  This is on purpose - best practice is to keep access keys out of github.  We will define these in a different file.</p>
<p>You can see we also set a default AWS_REGION as well as AMIs to use.  I am only setting 1, but you can make as complicated of a map variable as you want with multiple regions, different types of instances (maybe a Deep learning ami, and a random forest ami, and a generally compute ami).</p>

<pre><code>variable "AWS_ACCESS_KEY" {}
variable "AWS_SECRET_KEY" {}
variable "AWS_REGION" {
    default = "us-east-1"
}

variable "AMIS" {
    type = map(string)
    default = {
        us-east-1 = "ami-0ac80df6eff0e70b5"
    }
}</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="terraform.tfvars">
<a class="anchor" href="#terraform.tfvars" aria-hidden="true"><span class="octicon octicon-link"></span></a>terraform.tfvars<a class="anchor-link" href="#terraform.tfvars"> </a>
</h3>
<p>This is a pretty simple file where we define the values for our credentials.  The important thing is to add this file to the gitignore so that it does not get put in the github reposity (for security reason).  It just holds your credentials, for example it may be.</p>

<pre><code>AWS_ACCESS_KEY = "ABCDE12345FGHI6789"
AWS_SECRET_KEY = "abc123def456+789ghi983klm</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="provider.tf">
<a class="anchor" href="#provider.tf" aria-hidden="true"><span class="octicon octicon-link"></span></a>provider.tf<a class="anchor-link" href="#provider.tf"> </a>
</h3>
<p>Next. we will connect to aws using the keys we defined in the terraform.tfvars and vars.tf files.  The provider.tf file looks like this:</p>

<pre><code>provider "aws" {
access_key = "${var.AWS_ACCESS_KEY}"
secret_key = "${var.AWS_SECRET_KEY}"
region = "${var.AWS_REGION}"
}</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="instance.tf">
<a class="anchor" href="#instance.tf" aria-hidden="true"><span class="octicon octicon-link"></span></a>instance.tf<a class="anchor-link" href="#instance.tf"> </a>
</h3>
<p>Now finally we are ready to launch our instance.  We have our region, our credentials, and are connected to aws.  Naturally we could have 100 different instances defined in this same way for different regions and instance types and it will automatically create them all, but for now we will just create 1 and stay within the free-tier.</p>

<pre><code>resource "aws_instance" "web" {
ami = "${lookup(var.AMIS, var.AWS_REGION)}"
instance_type = "t2.micro"
}</code></pre>
<p>You will notice I am using the lookup funciton.  This is looking up the var.AWS_REGION from the var.AMIS variable.  We set the default region to us-east-1 in the vars.tf file.  And it uses that to lookup that key in the AMIS variable, which is a map of strings.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Apply-the-Changes">
<a class="anchor" href="#Apply-the-Changes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Apply the Changes<a class="anchor-link" href="#Apply-the-Changes"> </a>
</h1>
<p>Now all you need to do is run <code>terraform apply</code> in your terminal and your t2.micro ec2 instance will automatically be created!  If it is a new folder for terraform, you will need to run <code>terraform init</code> in the folder before it will work.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="Isaac-Flath/fastblog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/fastblog/aws/infrastructure/terraform/devops/2020/07/15/Terraform-Part-1.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/fastblog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/fastblog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/fastblog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A personal blog of technical topics relating the machine learning</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://twitter.com/isaac_flath" title="isaac_flath"><svg class="svg-icon grey"><use xlink:href="/fastblog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
